<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Dialog.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: Dialog.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>ï»¿/// &lt;reference path="Game.js" />
/// &lt;reference path="Canvas.js" />
var vastengine = vastengine || {};

/**
 * Used to pause the game while waiting for user input. Uses the Canvas to 
 * show a HTML/CSS dialog box, returns the selection, closes, and resumes the game.
 * @constructor
 * @param {string} text The text to show in the dialog message (prompt).
 * @param {number} width The width of the dialog box.
 * @param {number} height Optional height of the dialog box. Use 0 to auto-size to the given text and options.
 * @param {Array.&lt;string>} options List of options to choose from.
 * @param {function} callback Function to call when an option is selected, passing selected index.
 */
vastengine.Dialog = function (text, width, height, options, callback) {
    this.width = width;
    this.height = height;
    this.callback = callback;

    // TODO: better place to get these from?
    this.buttonHeight = 80;
    this.lineSpacing = 50;
    this.textFont = (this.lineSpacing - 10) + 'pt Calibri';
    this.textPadding = 10;
    
    // build text lines
    this.textLines = this.buildTextLines(text, this.width - this.textPadding, this.textFont);

    // auto-height if not given a height.
    if (height &lt;= 0) {
        this.height = (this.textLines.length * this.lineSpacing) + this.textPadding + (options.length * this.buttonHeight);
    }
    
    // position such that the dialog box will be centered, build buttons and text.
    this.x = 0;
    this.y = 0;
    if (vastengine.Game.Canvas) {
        this.x = (vastengine.Game.Canvas.getCanvasWidth() / 2) - (this.width / 2);
        this.y = (vastengine.Game.Canvas.getCanvasHeight() / 2) - (this.height / 2);
    }
    
    this.buttons = this.buildButtons(options, this.x, this.y, this.width, this.height, this.buttonHeight);
    this.visible = false;

    // for a zoom-in animation when created.
    this.scale = function () {
        var currentScale = 0;
        return {
            get: function () { return currentScale; },
            update: function () {
                if (currentScale &lt; 1) {
                    currentScale += (1 - currentScale) * 0.25;
                }
                if (currentScale > 0.99) {
                    currentScale = 1;
                }
            }
        };
    }();
};


/**
 * Builds an array of individual lines of the dialog text based
 * such that it wraps neatly in the dialog box.
 * @param {string} text The text to build into lines.
 * @return {Array.&lt;string>} Individual lines of wrapped text.
 */
vastengine.Dialog.prototype.buildTextLines = function (text, maxWidth, font) {
    // determine line width.
    var lineWidth = -1;

    var context;
    if (vastengine.Game.Canvas) {
        context = vastengine.Game.Canvas.getDrawingContext();
        if (context) {
            context.font = font;
        }
    }
    
    var textLines = [];
    var words = text.split(' ');
    var line = '';
    for (var i = 0; i &lt; words.length; i++) {
        var currentLine = line + words[i] + ' ';
        if (context) {
            var currentLineWidth = context.measureText(currentLine).width;
            if (currentLineWidth > maxWidth && i > 0) {
                textLines.push(line);
                line = words[i] + ' ';
            }
            else {
                line = currentLine;
            }
        }
        
    }
    textLines.push(line); // the rest.

    return textLines;
};


/**
 * Builds buttons to be clicked on, including their position and size, for each of the given options.
 * @param {Array.&lt;string>} options The options to build buttons for.
 */
vastengine.Dialog.prototype.buildButtons = function (options, dialogX, dialogY, dialogW, dialogH, buttonHeight) {
    var buttons = [];
    for (var i = options.length - 1; i >= 0; i--) {
        buttons.push({ text: options[options.length - i - 1], x: dialogX, y: dialogY + dialogH - ((i + 1) * buttonHeight), w: dialogW, h: buttonHeight });
    }
    return buttons;
};


/**
 * Sets whether this Dialog object is visible on the screen.
 * @param {boolean} isVisible True to show the dialog.
 */
vastengine.Dialog.prototype.setVisible = function (isVisible) {
    this.visible = isVisible;
};


/**
 * Determines whether this Dialog is currently visible.
 * @return {boolean} True if the Dialog object is currently visible (being drawn).
 */
vastengine.Dialog.prototype.isVisible = function () {
    return this.visible;
};


/**
 * Touch event-handler. Determine if any of the buttons were clicked on, and if 
 * so call this Dialog object's callback function with the selected index then hide this dialog.
 * @param {number} x X-coordinate of touch event.
 * @param {number} y Y-coordinate of touch event.
 */
vastengine.Dialog.prototype.onTouch = function (x, y) {
    var clickedOn = -1;

    // see if a button was clicked on.
    for (var i = 0; i &lt; this.buttons.length; i++) {
        if (x > this.buttons[i].x && x &lt; (this.buttons[i].x + this.buttons[i].w) && y > this.buttons[i].y && (y &lt; this.buttons[i].y + this.buttons[i].h)) {
            clickedOn = i;
        }
    }

    // destroy the dialog if a button was clicked and call the callback.
    if (clickedOn > -1) {
        vastengine.Game.setDialog(undefined);
        this.doCallback(clickedOn);
    }
};


/**
 * Calls the Dialog's callback with the given input.
 * @param {number} Integer selection.
 */
vastengine.Dialog.prototype.doCallback = function (input) {
    if (this.callback) {
        this.callback(input);
    }
};


/**
 * Draw the dialog box and its components.
 */
vastengine.Dialog.prototype.draw = function () {
    if (this.visible) {
        var context = vastengine.Game.Canvas.getDrawingContext();
        this.scale.update();

        // background shadow
        context.fillStyle = '#000';
        context.globalAlpha = 0.5;
        context.fillRect(0, 0, vastengine.Game.Canvas.getCanvasWidth(), vastengine.Game.Canvas.getCanvasHeight());

        // dialog background
        context.globalAlpha = 1;
        context.shadowBlur = 20;
        context.shadowColor = "black";
        context.fillStyle = '#FFF';
        context.fillRect(this.x + ((this.width - this.width * this.scale.get()) / 2), this.y + ((this.height - this.height * this.scale.get()) / 2), this.width * this.scale.get(), this.height * this.scale.get());
        context.shadowBlur = 0;

        // draw text and buttons only when animation is finished.
        if (this.scale.get() === 1) {
            // text
            context.textBaseline = 'top';
            context.fillStyle = '#000';
            context.font = this.textFont;
            
            for (var i = 0; i &lt; this.textLines.length; i++) {
                context.fillText(this.textLines[i], this.x + this.textPadding, this.y + i * this.lineSpacing);
            }
            // buttons
            context.font = (this.buttonHeight / 2) + 'pt Calibri';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            for (var n = 0; n &lt; this.buttons.length; n++) {
                context.fillText(this.buttons[n].text, this.buttons[n].x + (this.buttons[n].w / 2), this.buttons[n].y + (this.buttons[n].h / 2));
            }
        }
        
        // reset context styles
        vastengine.Game.Canvas.resetContext();
    }
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="vastengine.AssetManager.html">AssetManager</a></li><li><a href="vastengine.Canvas.html">Canvas</a></li><li><a href="vastengine.Controller.html">Controller</a></li><li><a href="vastengine.Dialog.html">Dialog</a></li><li><a href="vastengine.Entity.html">Entity</a></li><li><a href="vastengine.Game.html">Game</a></li><li><a href="vastengine.Input.html">Input</a></li><li><a href="vastengine.MathUtil.html">MathUtil</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Fri Jan 16 2015 15:38:43 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
