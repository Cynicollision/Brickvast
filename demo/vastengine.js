'use strict';var vastengine=vastengine||{};vastengine.AssetManager=function(a){this.assets=[];this.type=a;if(a!=vastengine.AssetType.IMAGE&&a!=vastengine.AssetType.AUDIO)throw'Invalid asset type "'+a+'"';};vastengine.AssetType={IMAGE:"image",AUDIO:"audio"};vastengine.AssetManager.prototype.add=function(a,b){this.assets.push({id:a,source:b,asset:void 0})};vastengine.AssetManager.prototype.getById=function(a){for(var b=0;b<this.assets.length;b++)if(this.assets[b].id===a)return this.assets[b].asset};
vastengine.AssetManager.prototype.load=function(){for(var a=0;a<this.assets.length;a++)this.type===vastengine.AssetType.IMAGE?this.assets[a].asset=new Image:this.type===vastengine.AssetType.AUDIO&&(this.assets[a].asset=new Audio(this.assets[a].source)),this.assets[a].asset.src=this.assets[a].source};vastengine=vastengine||{};vastengine.Canvas=function(){this.buildCanvas();this.canvas.onmousedown=function(a){vastengine.Game.Input.onTouch(a)};this.canvas.onmouseup=function(a){vastengine.Game.Input.onTouchEnd(a)}};vastengine.CanvasScaleMode={NONE:0,FIT:1,COVER:2};
vastengine.Canvas.prototype.buildCanvas=function(){this.canvas=document.createElement("canvas");this.canvas.id="vastCanvas";this.setCanvasSize(vastengine.Game.Config.canvasWidth,vastengine.Game.Config.canvasHeight);this.context=this.canvas.getContext("2d");document.body.appendChild(this.canvas)};vastengine.Canvas.prototype.getDrawingContext=function(){return this.context};vastengine.Canvas.prototype.setBackgroundColor=function(a){this.canvas.style.background=a};
vastengine.Canvas.prototype.setBackgroundImage=function(a,b){this.canvas.style.backgroundImage="url("+a+")";b||(this.canvas.style.backgroundRepeat="no-repeat")};vastengine.Canvas.prototype.setBackgroundPosition=function(a,b){this.canvas.style.backgroundPosition=a+"px "+b+"px"};vastengine.Canvas.prototype.getCanvasWidth=function(){return this.canvas.width};vastengine.Canvas.prototype.getCanvasHeight=function(){return this.canvas.height};
vastengine.Canvas.prototype.setCanvasSize=function(a,b){this.canvas.width=a;this.canvas.height=b};vastengine.Canvas.prototype.setScaleMode=function(a){this.scaleMode=a};vastengine.Canvas.prototype.scaleCanvas=function(){var a=this.getScale();this.canvas.style.transformOrigin="0 0";this.canvas.style.transform="scale("+a+")"};
vastengine.Canvas.prototype.getScale=function(){switch(this.scaleMode){case vastengine.CanvasScaleMode.COVER:return Math.max(window.innerWidth/this.canvas.width,window.innerHeight/this.canvas.height);case vastengine.CanvasScaleMode.FIT:return Math.min(window.innerWidth/this.canvas.width,window.innerHeight/this.canvas.height);default:return 1}};vastengine.Canvas.prototype.getViewRelativeX=function(a){return void 0!==a.view?a.view.x:0};
vastengine.Canvas.prototype.getViewRelativeY=function(a){return void 0!==a.view?a.view.y:0};
vastengine.Canvas.prototype.draw=function(a){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var b=this.getViewRelativeX(a),d=this.getViewRelativeY(a);this.setBackgroundPosition(-b,-d);a.sortEntities();a=a.getEntities();for(var c=0;c<a.length;c++)if(a[c].draw&&a[c].draw(),a[c]){var e=a[c].getImage();if(e)try{this.context.drawImage(e,a[c].x-b,a[c].y-d)}catch(f){vastengine.Game.setError("Failed drawing entity image: "+e.src)}}this.scaleCanvas()};vastengine=vastengine||{};vastengine.Controller=function(){this.entities=[];this.view={x:0,y:0};this.onTouch=this.postStep=null};vastengine.Controller.prototype.setViewPosition=function(a,b){this.view.x=a;this.view.y=b};
vastengine.Controller.prototype.step=function(){this.removeDestroyedEntities();for(var a=0;a<this.entities.length;a++)0!==this.entities[a].speed&&(this.entities[a].x+=Math.round(vastengine.MathUtil.getLengthDirectionX(this.entities[a].getSpeed(),this.entities[a].getDirection())/10),this.entities[a].y+=Math.round(vastengine.MathUtil.getLengthDirectionY(this.entities[a].getSpeed(),this.entities[a].getDirection())/10)),this.entities[a].step&&this.entities[a].step();this.postStep&&this.postStep()};
vastengine.Controller.prototype.setPostStep=function(a){this.postStep=a};vastengine.Controller.prototype.setOnTouch=function(a){this.onTouch=a};vastengine.Controller.prototype.addEntity=function(a){this.entities.push(a)};vastengine.Controller.prototype.getEntities=function(){return this.entities};vastengine.Controller.prototype.getEntityById=function(a){for(var b=0;b<this.entities.length;b++)if(this.entities[b].id===a)return this.entities[b]};
vastengine.Controller.prototype.getEntitiesByType=function(a){for(var b=[],d=0;d<this.entities.length;d++)this.entities[d].type===a&&b.push(this.entities[d]);return b};vastengine.Controller.prototype.getEntitiesAtPosition=function(a,b,d){for(var c=[],e=0;e<this.entities.length;e++)this.entities[e].onPosition(a,b)&&(d&&this.entities[e].type!==d||c.push(this.entities[e]));return c};
vastengine.Controller.prototype.isPositionFree=function(a,b,d){for(var c=0;c<this.entities.length;c++)if(this.entities[c].onPosition(a,b)&&(!d||d===this.entities[c].type))return!1;return!0};vastengine.Controller.prototype.sortEntities=function(){this.entities.sort(function(a,b){return-(a.depth-b.depth)})};vastengine.Controller.prototype.removeDestroyedEntities=function(){void 0!==this.entities&&0<this.entities.length&&(this.entities=this.entities.filter(function(a){return!a||!a.isDestroyed}))};vastengine=vastengine||{};vastengine.Dialog=function(a,b,d,c,e){this.text=a;this.width=b;this.height=d;this.options=c;this.callback=e;this.scale=1;this.x=vastengine.Game.Canvas.getCanvasWidth()/2-this.width/2;this.y=vastengine.Game.Canvas.getCanvasHeight()/2-this.height/2;this.visible=!1;this.textPadding=10;this.buttons=this.buildButtons();this.state=function(){var a=vastengine.DialogState.closed;return{get:function(){return a},set:function(b){a=b}}}()};
vastengine.Dialog.prototype.buildButtons=function(){var a=[];if(1===this.options.length)a.push({text:this.options[0],x:this.x,y:this.y+this.height-50,w:this.width,h:50});else if(2===this.options.length)a.push({text:this.options[0],x:this.x,y:this.y+this.height-50,w:this.width/2,h:50}),a.push({text:this.options[1],x:this.x+this.width/2,y:this.y+this.height-50,w:this.width/2,h:50});else for(var b=0;b<this.options.length;b++);return a};vastengine.DialogState={closed:0,open:1};
vastengine.Dialog.prototype.show=function(){this.state.get()===vastengine.DialogState.closed&&(this.visible=!0,this.scale=0,this.state.set(vastengine.DialogState.open))};vastengine.Dialog.prototype.hide=function(){this.state.get()===vastengine.DialogState.open&&(this.visible=!1,this.state.set(vastengine.DialogState.open))};
vastengine.Dialog.prototype.onTouch=function(a,b){var d=-1;if(this.state.get()===vastengine.DialogState.open){for(var c=0;c<this.buttons.length;c++)a>this.buttons[c].x&&a<this.buttons[c].x+this.buttons[c].w&&b>this.buttons[c].y&&b<this.buttons[c].y+this.buttons[c].h&&(d=c);-1<d&&(vastengine.Game.setDialog(void 0),this.callback&&this.callback(d))}};
vastengine.Dialog.prototype.draw=function(){if(this.visible){var a=$vast.Game.Canvas.getDrawingContext(),b=a.fillStyle,d=a.globalAlpha,c=a.textAlign,e=a.textBaseline,f=a.font;0.8>this.scale?this.scale+=0.2:0.75<this.scale&&(this.scale=1);a.fillStyle="#000";a.globalAlpha=0.5;a.fillRect(0,0,vastengine.Game.Canvas.getCanvasWidth(),vastengine.Game.Canvas.getCanvasHeight());a.globalAlpha=1;a.fillStyle="#FFF";a.fillRect(this.x+(this.width-this.width*this.scale)/2,this.y+(this.height-this.height*this.scale)/
2,this.width*this.scale,this.height*this.scale);if(1===this.scale){a.textBaseline="top";a.font="18pt Calibri";a.fillStyle="#000";for(var k=this.text.split(" "),h="",l=this.y,g=0;g<k.length;g++){var m=h+k[g]+" ";a.measureText(m).width>this.width-this.textPadding&&0<g?(a.fillText(h,this.x+this.textPadding,l),h=k[g]+" ",l+=22):h=m}a.font="20pt Calibri";a.textAlign="center";a.textBaseline="middle";for(g=0;g<this.buttons.length;g++)a.fillText(this.buttons[g].text,this.buttons[g].x+this.buttons[g].w/2,
this.buttons[g].y+this.buttons[g].h/2)}a.fillStyle=b;a.globalAlpha=d;a.textAlign=c;a.textBaseline=e;a.font=f}};vastengine=vastengine||{};vastengine.Entity=function(a,b){this.depth=this.y=this.x=0;this.type=a;this.id=b;this.isDestroyed=!1;this.height=this.width=this.direction=this.speed=0;this.draw=this.step=this.onTouchEnd=this.onTouch=null};vastengine.Entity.prototype.setOnTouch=function(a){this.onTouch=a};vastengine.Entity.prototype.setOnTouchEnd=function(a){this.onTouchEnd=a};vastengine.Entity.prototype.setStep=function(a){this.step=a};vastengine.Entity.prototype.setDraw=function(a){this.draw=a};
vastengine.Entity.prototype.mouseup=function(a,b){};vastengine.Entity.prototype.destroy=function(){this.isDestroyed=!0};vastengine.Entity.prototype.checkCollision=function(a){return!(this.x+this.width<a.x+1||a.x+a.width-1<this.x||this.y+this.height<a.y+1||a.y+a.height-1<this.y)};vastengine.Entity.prototype.onPosition=function(a,b){return a>this.x&&b>this.y&&a<this.x+this.width&&b<this.y+this.height};vastengine.Entity.prototype.getImage=function(){return this.image};
vastengine.Entity.prototype.setImage=function(a){this.image=a};vastengine.Entity.prototype.setPosition=function(a,b){this.x=a;this.y=b};vastengine.Entity.prototype.getX=function(){return this.x};vastengine.Entity.prototype.setX=function(a){this.x=a};vastengine.Entity.prototype.getY=function(){return this.y};vastengine.Entity.prototype.setY=function(a){this.y=a};vastengine.Entity.prototype.getSpeed=function(){return this.speed};vastengine.Entity.prototype.setSpeed=function(a){this.speed=a};
vastengine.Entity.prototype.getDirection=function(){return this.direction};vastengine.Entity.prototype.setDirection=function(a){this.direction=a};vastengine.Entity.prototype.setSize=function(a,b){this.width=a;this.height=b};var $vast=vastengine=vastengine||{};vastengine.Game=function(){this.activeDialog=this.activeController=null};vastengine.Game.Config={fps:60,canvasWidth:640,canvasHeight:512};vastengine.Game.setActiveController=function(a){this.activeController=a};vastengine.Game.getActiveController=function(){return this.activeController};vastengine.Game.hasActiveControler=function(){return this.activeController?void 0!==this.activeController.view:!1};
vastengine.Game.setDialog=function(a){a?(this.activeDialog=a,this.activeDialog.show(),vastengine.Game.running=!1):(vastengine.Game.running=!0,this.activeDialog.hide(),this.activeDialog=void 0)};vastengine.Game.running=!0;vastengine.Game.getTimestamp=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()};
vastengine.Game.init=function(){vastengine.Game.Input=new vastengine.Input;vastengine.Game.Images=new vastengine.AssetManager(vastengine.AssetType.IMAGE);vastengine.Game.Audio=new vastengine.AssetManager(vastengine.AssetType.AUDIO);vastengine.Game.Canvas=new vastengine.Canvas};
vastengine.Game.run=function(){function a(){var e=vastengine.Game.getTimestamp();for(d+=Math.min(1,(e-c)/1E3);d>b;)vastengine.Game.running&&vastengine.Game.hasActiveControler()&&vastengine.Game.getActiveController().step(b),d-=b;vastengine.Game.hasActiveControler()&&vastengine.Game.Canvas.draw(vastengine.Game.getActiveController());vastengine.Game.activeDialog&&vastengine.Game.activeDialog.draw();c=e;requestAnimationFrame(a)}var b=1/vastengine.Game.Config.fps,d=0,c=vastengine.Game.getTimestamp();
requestAnimationFrame(a)};vastengine.Game.setError=function(a){var b="vastengine error: ";a&&(b+=a);throw b;};vastengine=vastengine||{};vastengine.Input=function(){this.currentTouchY=this.currentTouchX=-1};vastengine.InputEventType={touchStart:0,touchEnd:1};vastengine.Input.prototype.onTouch=function(a){this.onTouchEvent(vastengine.InputEventType.touchStart,a.pageX,a.pageY)};vastengine.Input.prototype.onTouchEnd=function(a){this.onTouchEvent(vastengine.InputEventType.touchEnd,a.pageX,a.pageY)};
vastengine.Input.prototype.onTouchEvent=function(a,b,d){var c=vastengine.Game.getActiveController(),e=vastengine.Game.Canvas.getScale();b=b/e+c.view.x;d=d/e+c.view.y;if(vastengine.Game.activeDialog){if(a===vastengine.InputEventType.touchStart)vastengine.Game.activeDialog.onTouch(b,d)}else if(a===vastengine.InputEventType.touchStart&&c.onTouch)c.onTouch(b,d);else if(c.onTouchEnd)c.onTouchEnd(b,d);if(vastengine.Game.running)for(c=c.getEntities(),e=0;e<c.length;e++){var f=c[e];if(0<f.width&&0<f.height&&
b>f.x&&d>f.y&&b<f.x+f.width&&d<f.y+f.height)if(a===vastengine.InputEventType.touchStart&&f.onTouch)f.onTouch(b,d);else if(f.onTouchEnd)f.onTouchEnd(b,d)}};vastengine=vastengine||{};vastengine.MathUtil={};vastengine.MathUtil.getPointDistance=function(a,b,d,c){return Math.sqrt((d-a)*(d-a)+(c-b)*(c-b))};vastengine.MathUtil.getPointDirection=function(a,b,d,c){a=180/Math.PI*Math.atan2(c-b,d-a);360<a?a-=360:0>a&&(a+=360);return a};vastengine.MathUtil.getLengthDirectionX=function(a,b){return Math.floor(a*Math.cos(Math.PI/180*b))};vastengine.MathUtil.getLengthDirectionY=function(a,b){return Math.floor(a*Math.sin(Math.PI/180*b))};
